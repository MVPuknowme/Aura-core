FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY app.py .
	ENV ORCH_TOKEN=replace-()
EXPOSE 8080
CMD ["gunicorn","-b","0.0.0.0:8080","app:app","--workers","2"]
import importlib
import pkgutil
import sys
from typing import Dict, Type

BASE_PACKAGE = "src.connectors"
CONNECTORS: Dict[str, Type] = {}

def autodetect_connectors():
    """Scan connectors folder and register modules dynamically."""
    package = importlib.import_module(BASE_PACKAGE)

    for _, name, ispkg in pkgutil.iter_modules(package.__path__):
        if not ispkg:
            continue

        key = f"auracore/{name}"

        try:
            module_path = f"{BASE_PACKAGE}.{name}.{name}"

            # reload if already imported (hot reload)
            if module_path in sys.modules:
                module = importlib.reload(sys.modules[module_path])
            else:
                module = importlib.import_module(module_path)

            class_name = name.capitalize()
            connector_cls = getattr(module, class_name)

            CONNECTORS[key] = connector_cls
            print(f"üîó hot-loaded connector: {key}")

        except Exception as e:
            print(f"‚ö†Ô∏è connector skipped {name}: {e}")

def build_connector(connect_name, cfg, store):
    if connect_name not in CONNECTORS:
        raise ValueError(f"Unknown connector {connect_name}")
    return CONNECTORS[connect_name](cfg, store)
